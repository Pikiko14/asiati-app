import{Q as me,a as fe}from"./QForm.e9176afe.js";import{r as x,e as g,K as ne,s as pe,m as se,c as he,G as I,o as ve,aB as ge,au as _e,aC as be,aE as ye,aV as $e,bg as Fe,aW as Y,ay as Se,aD as Ce,h as De,d as we,Y as U,aj as re,_ as R,$ as B,ae as H,a2 as m,a1 as V,af as t,F as Oe,ah as J,az as Z,aA as y,an as ee,ai as xe,a5 as T,am as te,a0 as Ve}from"./index.d29c8e76.js";import{U as W}from"./utils.22a4e13b.js";import{e as qe,b as Ie,c as oe,C as Ee,g as G,m as Pe,H as Te}from"./QTable.525c7713.js";import{h as ze}from"./QList.a8cf2929.js";import{R as Ae}from"./auth.bb8238f6.js";import{notification as Me}from"./notification.ebb7e7a1.js";import{T as je}from"./tableAsiati.79bd0b79.js";function P(e,l,_,f){const s=[];return e.forEach(a=>{f(a)===!0?s.push(a):l.push({failedPropValidation:_,file:a})}),s}function k(e){e&&e.dataTransfer&&(e.dataTransfer.dropEffect="copy"),se(e)}const Ne={multiple:Boolean,accept:String,capture:String,maxFileSize:[Number,String],maxTotalSize:[Number,String],maxFiles:[Number,String],filter:Function},ke=["rejected"];function Ue({editable:e,dnd:l,getFileInput:_,addFilesToQueue:f}){const{props:s,emit:a,proxy:n}=ne(),b=x(null),p=g(()=>s.accept!==void 0?s.accept.split(",").map(o=>(o=o.trim(),o==="*"?"*/":(o.endsWith("/*")&&(o=o.slice(0,o.length-1)),o.toUpperCase()))):null),$=g(()=>parseInt(s.maxFiles,10)),w=g(()=>parseInt(s.maxTotalSize,10));function h(o){if(e.value)if(o!==Object(o)&&(o={target:null}),o.target!==null&&o.target.matches('input[type="file"]')===!0)o.clientX===0&&o.clientY===0&&pe(o);else{const D=_();D&&D!==o.target&&D.click(o)}}function C(o){e.value&&o&&f(null,o)}function z(o,D,M,j){let i=Array.from(D||o.target.files);const S=[],q=()=>{S.length!==0&&a("rejected",S)};if(s.accept!==void 0&&p.value.indexOf("*/")===-1&&(i=P(i,S,"accept",u=>p.value.some(v=>u.type.toUpperCase().startsWith(v)||u.name.toUpperCase().endsWith(v))),i.length===0))return q();if(s.maxFileSize!==void 0){const u=parseInt(s.maxFileSize,10);if(i=P(i,S,"max-file-size",v=>v.size<=u),i.length===0)return q()}if(s.multiple!==!0&&i.length!==0&&(i=[i[0]]),i.forEach(u=>{u.__key=u.webkitRelativePath+u.lastModified+u.name+u.size}),j===!0){const u=M.map(v=>v.__key);i=P(i,S,"duplicate",v=>u.includes(v.__key)===!1)}if(i.length===0)return q();if(s.maxTotalSize!==void 0){let u=j===!0?M.reduce((v,Q)=>v+Q.size,0):0;if(i=P(i,S,"max-total-size",v=>(u+=v.size,u<=w.value)),i.length===0)return q()}if(typeof s.filter=="function"){const u=s.filter(i);i=P(i,S,"filter",v=>u.includes(v))}if(s.maxFiles!==void 0){let u=j===!0?M.length:0;if(i=P(i,S,"max-files",()=>(u++,u<=$.value)),i.length===0)return q()}if(q(),i.length!==0)return i}function d(o){k(o),l.value!==!0&&(l.value=!0)}function c(o){se(o),(o.relatedTarget!==null||he.is.safari!==!0?o.relatedTarget!==b.value:document.elementsFromPoint(o.clientX,o.clientY).includes(b.value)===!1)===!0&&(l.value=!1)}function E(o){k(o);const D=o.dataTransfer.files;D.length!==0&&f(null,D),l.value=!1}function A(o){if(l.value===!0)return I("div",{ref:b,class:`q-${o}__dnd absolute-full`,onDragenter:k,onDragover:k,onDragleave:c,onDrop:E})}return Object.assign(n,{pickFiles:h,addFiles:C}),{pickFiles:h,addFiles:C,onDragover:d,onDragleave:c,processFiles:z,getDndNode:A,maxFilesNumber:$,maxTotalSizeNumber:w}}var Re=ve({name:"QFile",inheritAttrs:!1,props:{...ge,..._e,...Ne,modelValue:[File,FileList,Array],append:Boolean,useChips:Boolean,displayValue:[String,Number],tabindex:{type:[String,Number],default:0},counterLabel:Function,inputClass:[Array,String,Object],inputStyle:[Array,String,Object]},emits:[...be,...ke],setup(e,{slots:l,emit:_,attrs:f}){const{proxy:s}=ne(),a=ye(),n=x(null),b=x(!1),p=$e(e),{pickFiles:$,onDragover:w,onDragleave:h,processFiles:C,getDndNode:z}=Ue({editable:a.editable,dnd:b,getFileInput:K,addFilesToQueue:X}),d=Fe(e),c=g(()=>Object(e.modelValue)===e.modelValue?"length"in e.modelValue?Array.from(e.modelValue):[e.modelValue]:[]),E=g(()=>Y(c.value)),A=g(()=>c.value.map(r=>r.name).join(", ")),o=g(()=>ze(c.value.reduce((r,F)=>r+F.size,0))),D=g(()=>({totalSize:o.value,filesNumber:c.value.length,maxFiles:e.maxFiles})),M=g(()=>({tabindex:-1,type:"file",title:"",accept:e.accept,capture:e.capture,name:p.value,...f,id:a.targetUid.value,disabled:a.editable.value!==!0})),j=g(()=>"q-file q-field--auto-height"+(b.value===!0?" q-file--dnd":"")),i=g(()=>e.multiple===!0&&e.append===!0);function S(r){const F=c.value.slice();F.splice(r,1),u(F)}function q(r){const F=c.value.indexOf(r);F!==-1&&S(F)}function u(r){_("update:modelValue",e.multiple===!0?r:r[0])}function v(r){r.keyCode===13&&De(r)}function Q(r){(r.keyCode===13||r.keyCode===32)&&$(r)}function K(){return n.value}function X(r,F){const O=C(r,F,c.value,i.value),L=K();L!=null&&(L.value=""),O!==void 0&&((e.multiple===!0?e.modelValue&&O.every(ce=>c.value.includes(ce)):e.modelValue===O[0])||u(i.value===!0?c.value.concat(O):O))}function N(){return[I("input",{class:[e.inputClass,"q-file__filler"],style:e.inputStyle})]}function de(){if(l.file!==void 0)return c.value.length===0?N():c.value.map((F,O)=>l.file({index:O,file:F,ref:this}));if(l.selected!==void 0)return c.value.length===0?N():l.selected({files:c.value,ref:this});if(e.useChips===!0)return c.value.length===0?N():c.value.map((F,O)=>I(qe,{key:"file-"+O,removable:a.editable.value,dense:!0,textColor:e.color,tabindex:e.tabindex,onRemove:()=>{S(O)}},()=>I("span",{class:"ellipsis",textContent:F.name})));const r=e.displayValue!==void 0?e.displayValue:A.value;return r.length!==0?[I("div",{class:e.inputClass,style:e.inputStyle,textContent:r})]:N()}function ue(){const r={ref:n,...M.value,...d.value,class:"q-field__input fit absolute-full cursor-pointer",onChange:X};return e.multiple===!0&&(r.multiple=!0),I("input",r)}return Object.assign(a,{fieldClass:j,emitValue:u,hasValue:E,inputRef:n,innerValue:c,floatingLabel:g(()=>E.value===!0||Y(e.displayValue)),computedCounter:g(()=>{if(e.counterLabel!==void 0)return e.counterLabel(D.value);const r=e.maxFiles;return`${c.value.length}${r!==void 0?" / "+r:""} (${o.value})`}),getControlChild:()=>z("file"),getControl:()=>{const r={ref:a.targetRef,class:"q-field__native row items-center cursor-pointer",tabindex:e.tabindex};return a.editable.value===!0&&Object.assign(r,{onDragover:w,onDragleave:h,onKeydown:v,onKeyup:Q}),I("div",r,[ue()].concat(de()))}}),Object.assign(s,{removeAtIndex:S,removeFile:q,getNativeElement:()=>n.value}),Se(s,"nativeEl",()=>n.value),Ce(a)}});const ae="orders",le=new Ae({Accept:"application/json"}),ie=we("ordersStore",()=>{const e=x([]),l=x(0);return{orders:e,totalItems:l,doListOrders:async s=>{try{const a=await le.doGetRequest(`${ae}`,s,!0);if(a.success)return e.value=a.data.companies,l.value=a.data.totalItems,a}catch{}},doImportOrders:async s=>{try{const a=await le.doPostRequest(`${ae}/import`,s,!0,!0);if(a.success)return a}catch{}}}}),Be=U({name:"ImportOrdersComponent",emits:["close-modal"],setup(e,{emit:l}){const _=new W("orders"),f=ie(),s=x(!1),a=x({file:null,company:null,type:null}),n=Ie(),b=["Dropi"],p=g(()=>n.companies.length>0?n.companies.map(h=>({label:`${h.name}`,value:h._id})):[]),$=async()=>{try{await n.listForSelect()}catch{}},w=async()=>{try{s.value=!0;const h=_.transformObjectInFormData(a.value,!1,null),C=await f.doImportOrders(h);C&&C.success&&(Me("positive",C.message,"primary"),l("close-modal"))}catch{}finally{s.value=!1}};return re(async()=>{p.value.length>0||await $()}),{order:a,loading:s,companies:p,typeOrder:b,doImportOrders:w}}}),Qe={class:"full-width"},Le={class:"col-12"},Ge=t("label",{for:"",class:"text-weight-semi-bold"},"Archivo excel",-1),He={class:"col-12"},We=t("label",{for:"",class:"text-weight-semi-bold"},"Tienda",-1),Ke={class:"col-12"},Xe=t("label",{for:"",class:"text-weight-semi-bold"},"Tipo ecommerce",-1);function Ye(e,l,_,f,s,a){return B(),H("div",Qe,[m(me,{class:"row full-width",onSubmit:e.doImportOrders},{default:V(()=>[t("div",Le,[Ge,m(Re,{dense:"",modelValue:e.order.file,"onUpdate:modelValue":l[0]||(l[0]=n=>e.order.file=n),label:"Selecciona un archivo",outlined:"",rounded:"",rules:[n=>!!n||"Este campo es requerido"]},null,8,["modelValue","rules"])]),t("div",He,[We,m(oe,{options:e.companies,"map-options":"","emit-value":"",dense:"",modelValue:e.order.company,"onUpdate:modelValue":l[1]||(l[1]=n=>e.order.company=n),label:"Selecciona la tienda",outlined:"",rounded:"",rules:[n=>!!n||"Este campo es requerido"]},null,8,["options","modelValue","rules"])]),t("div",Ke,[Xe,m(oe,{options:e.typeOrder,"map-options":"","emit-value":"",dense:"",modelValue:e.order.type,"onUpdate:modelValue":l[2]||(l[2]=n=>e.order.type=n),label:"Selecciona un archivo",outlined:"",rounded:"",rules:[n=>!!n||"Este campo es requerido"]},null,8,["options","modelValue","rules"])]),t("div",{class:Z(["col-12 col-md-6 q-mt-xl",{"q-pr-sm":e.$q.screen.gt.sm}])},[Oe(m(J,{label:"Cancelar",color:"info","no-caps":"",rounded:"",outline:"",class:"full-width"},null,512),[[Ee]])],2),t("div",{class:Z(["col-12 col-md-6 q-mt-xl",{"q-pl-sm":e.$q.screen.gt.sm}])},[m(J,{loading:e.loading,type:"submit",unelevated:"",label:"Importar",color:"primary","no-caps":"",rounded:"",class:"full-width"},null,8,["loading"])],2)]),_:1},8,["onSubmit"])])}var Je=R(Be,[["render",Ye]]);const Ze=U({name:"DetailOrdersComponent",props:{order:{type:Object,default:()=>({})}},setup(){return{utils:new W("oders")}}}),et={class:"full-weidth row"},tt={class:"col-12"},ot=t("thead",null,[t("tr",null,[t("th",{class:"text-left"},"Fecha"),t("th",{class:"text-left"},"Tel\xE9fono"),t("th",{class:"text-center"},"# Gu\xEDa"),t("th",{class:"text-center"},"Estado gu\xEDa")])],-1),at={class:"text-left"},lt={class:"text-left"},nt={class:"text-center"},st={class:"text-center"},rt=t("thead",null,[t("tr",null,[t("th",{class:"text-left"},"Departamento"),t("th",{class:"text-left"},"Ciudad"),t("th",{class:"text-left"},"Transportadora"),t("th",{class:"text-left"},"Tienda")])],-1),it={class:"text-left"},dt={class:"text-left"},ut={class:"text-left"},ct={class:"text-left"},mt={class:"col-12 q-mt-md"},ft=t("span",{class:"font-12 text-primary text-weight-bold text-primary"},"Productos:",-1),pt={class:"col-12 q-mt-md"},ht=t("span",{class:"font-12 text-primary text-weight-bold text-primary"},"Nota:",-1),vt={class:"col-12 q-mt-md"},gt=t("thead",null,[t("tr",null,[t("th",{class:"text-center"},"Total env\xEDo"),t("th",{class:"text-center"},"Total orden"),t("th",{class:"text-center"},"Total devoluci\xF3n"),t("th",{class:"text-center"},"Total ganancia")])],-1),_t={class:"text-center"},bt={class:"text-center"},yt={class:"text-center"},$t={class:"text-center"};function Ft(e,l,_,f,s,a){var n,b;return B(),H("div",et,[t("div",tt,[m(G,{class:"q-pa-none shadow-0"},{default:V(()=>{var p,$;return[ot,t("tbody",null,[t("tr",null,[t("td",at,y(e.order.date_order),1),t("td",lt,y(e.order.phone),1),t("td",nt,y((p=e.order.guide_number)!=null?p:"Sin gu\xEDa"),1),t("td",st,y(($=e.order.guide_status)!=null?$:"Sin gu\xEDa"),1)])])]}),_:1}),m(G,{class:"q-pa-none shadow-0 q-mt-md"},{default:V(()=>{var p;return[rt,t("tbody",null,[t("tr",null,[t("td",it,y(e.order.province),1),t("td",dt,y(e.order.city),1),t("td",ut,y(e.order.order_conveyor),1),t("td",ct,y((p=e.order.company)==null?void 0:p.name),1)])])]}),_:1})]),t("div",mt,[ft,ee(" "+y((n=e.order)==null?void 0:n.products)+" | X "+y(e.order.quantity)+" Und ",1)]),t("div",pt,[ht,ee(" "+y((b=e.order)==null?void 0:b.order_notes),1)]),t("div",vt,[m(G,{class:"q-pa-none shadow-0 q-mt-md"},{default:V(()=>[gt,t("tbody",null,[t("tr",null,[t("td",_t,y(e.utils.formatPrice(parseInt(e.order.freight_price))),1),t("td",bt,y(e.utils.formatPrice(parseInt(e.order.total_order))),1),t("td",yt,y(e.order.return_freight_cost>0?e.utils.formatPrice(parseInt(e.order.return_freight_cost)):"$0"),1),t("td",$t,y(e.order.order_profit>0?e.utils.formatPrice(parseInt(e.order.order_profit)):"$0"),1)])])]),_:1})])])}var St=R(Ze,[["render",Ft]]);const Ct=U({name:"OrdersMainComponent",components:{modalCard:Pe,importForm:Je,detailOrder:St,TableAsiati:je,HeaderComponent:Te},setup(){const e=[{name:"external_id",align:"left",sortable:!1,label:"Id externo",field:d=>`${d.external_id}`},{name:"date",align:"left",sortable:!1,label:"Fecha",field:d=>`${d.date_order}`},{name:"phone",align:"left",sortable:!1,label:"Tel\xE9fono",field:d=>`${d.phone}`},{name:"guide_number",align:"left",sortable:!1,label:"# Gu\xEDa",field:d=>`${d.guide_number}`},{name:"guide_status",align:"left",sortable:!1,label:"Estado gu\xEDa",field:d=>`${d.guide_status}`},{name:"freight_value",align:"center",sortable:!1,label:"Costo env\xEDo",field:d=>`${s.formatPrice(d.freight_price)}`},{name:"total_order",align:"center",sortable:!1,label:"Total orden",field:d=>`${s.formatPrice(d.total_order)}`},{name:"option",align:"center",sortable:!1,label:""}],l=xe(),_=x({}),f=ie(),s=new W("orders"),a=x(!1),n=x(!1),b=g(()=>f.orders),p=g(()=>f.totalItems),$=async()=>{a.value=!a.value,a.value||await C()},w=d=>{alert(d)},h=d=>{alert(d)},C=async()=>{try{const d=l.query.page||1,c=l.query.search||"",E=l.query.perPage||12,A=`?page=${d}&search=${c}&perPage=${E}`;await f.doListOrders(A)}catch{}},z=d=>{_.value=d,n.value=!n.value};return re(async()=>{await C()}),{rows:e,order:_,doEdit:h,doShow:z,orders:b,doDelete:w,openModal:$,totalItems:p,openModalImport:a,openOrderDetail:n}}}),Dt={class:"full-width"};function wt(e,l,_,f,s,a){const n=T("HeaderComponent"),b=T("TableAsiati"),p=T("importForm"),$=T("modalCard"),w=T("detailOrder");return B(),H("section",Dt,[m(n,{permission:"create-users",title:"Ordenes",btnLabel:"Importar",onOpenModal:e.openModal},null,8,["onOpenModal"]),m(b,{"permission-edit":"edit-orders",permissionShow:"list-orders","permission-delete":"delete-orders",rows:e.rows,columns:e.orders,"total-items":e.totalItems,onDoDelete:e.doDelete,onDoEdit:e.doEdit,onDoShow:e.doShow},null,8,["rows","columns","total-items","onDoDelete","onDoEdit","onDoShow"]),m(te,{modelValue:e.openModalImport,"onUpdate:modelValue":l[0]||(l[0]=h=>e.openModalImport=h)},{default:V(()=>[m($,{title:"Importar ordenes"},{body:V(()=>[m(p,{onCloseModal:e.openModal},null,8,["onCloseModal"])]),_:1})]),_:1},8,["modelValue"]),m(te,{modelValue:e.openOrderDetail,"onUpdate:modelValue":l[1]||(l[1]=h=>e.openOrderDetail=h)},{default:V(()=>[m($,{title:`Detalles de la orden ${e.order._id?e.order.external_id:""}`},{body:V(()=>[m(w,{order:e.order},null,8,["order"])]),_:1},8,["title"])]),_:1},8,["modelValue"])])}var Ot=R(Ct,[["render",wt]]);const xt=U({name:"UsersPage",components:{OrdersMain:Ot}});function Vt(e,l,_,f,s,a){const n=T("OrdersMain");return B(),Ve(fe,{padding:""},{default:V(()=>[m(n)]),_:1})}var jt=R(xt,[["render",Vt]]);export{jt as default};
