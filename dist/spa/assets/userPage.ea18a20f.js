import{Q as z}from"./QPage.26cd991d.js";import{Y as E,r as c,a7 as D,_ as A,$ as y,a0 as I,a1 as g,a6 as o,a2 as l,a8 as b,a9 as d,aa as U,bj as L,F as S,ab as O,e as M,ac as C,aC as Q,a5 as T,ad as Z}from"./index.f8830be8.js";import{a as k,H as N}from"./headers.491b9d41.js";import{Q as B}from"./QForm.2f7c127e.js";import{C as _,M as H}from"./modalCard.64c5e405.js";import{u as F}from"./users.e7f31235.js";import{notification as V}from"./notification.9f215daf.js";import{U as v}from"./models.4fd8c3a1.js";import{T as R}from"./tableAsiati.d1b3234d.js";import"./auth.92ad8fad.js";import"./QTable.6bebdade.js";import"./use-quasar.9bd09186.js";const j=E({name:"UserFormComponent",emits:["close-modal"],props:{userData:{type:Object,default:()=>({})}},setup(s,{emit:a}){const n=[{label:"Administrador",value:v.ADMIN},{label:"Ceo",value:v.CEO}],m=F(),t=c(!1),i=c(!1),e=c({username:"",password:"",email:"",role:v.CEO,scopes:["create-users","list-users","edit-users","delete-users","create-business","list-business","edit-business","delete-business","list-meta-metric","list-orders","import-orders","list-orders","import-orders"],is_active:!0,name:"",last_name:"",confirmation_password:"",phone:""}),w=[{label:"Crear usuarios",value:"create-users"},{label:"Listar usuarios",value:"list-users"},{label:"Editar usuarios",value:"edit-users"},{label:"Eliminar usuarios",value:"delete-users"},{label:"Crear empresas",value:"create-business"},{label:"Listar empresas",value:"list-business"},{label:"Editar empresas",value:"edit-business"},{label:"Eliminar empresas",value:"delete-business"},{label:"Listar metricas",value:"list-meta-metric"},{label:"Listar ordenes",value:"list-orders"},{label:"Importar ordenes",value:"import-orders"},{label:"Crear productos",value:"create-products"},{label:"Listar productos",value:"list-products"},{label:"Editar productos",value:"edit-products"},{label:"Eliminar productos",value:"delete-products"},{label:"Crear wallet",value:"create-wallet"},{label:"Listar wallet",value:"list-wallet"},{label:"Editar wallet",value:"edit-wallet"},{label:"Eliminar wallet",value:"delete-wallet"},{label:"Crear configuration",value:"create-configuration"},{label:"Listar configuration",value:"list-configuration"},{label:"Crear gastos",value:"create-expenses"},{label:"Listar gastos",value:"list-expenses"}],$=async()=>{if(t.value=!0,e.value.username=e.value.email.split("@")[0],e.value._id)return await h(),!0;try{const u=await m.doSaveUser(e.value);u.success&&(V("positive",u.message,"primary"),a("close-modal"),f())}catch{}finally{t.value=!1}},h=async()=>{try{const u=await m.doUpdateUser(e.value);u.success&&(V("positive",u.message,"primary"),a("close-modal"),f())}catch{}finally{t.value=!1}},f=()=>{e.value={username:"",password:"",email:"",role:v.CEO,scopes:[],is_active:!0,name:"",last_name:"",confirmation_password:"",phone:""}};return D(()=>{s.userData._id&&(e.value=s.userData)}),{user:e,scopes:w,loading:t,typeUsers:n,doSaveUser:$,showPassword:i}}}),G=o("label",{for:"",class:"text-weight-semi-bold"},"Nombres",-1),Y=o("label",{for:"",class:"text-weight-semi-bold"},"Apellidos",-1),J=o("label",{for:"",class:"text-weight-semi-bold"},"Tipo de usuario",-1),K=o("label",{for:"",class:"text-weight-semi-bold"},"Correo",-1),W={class:"col-12 col-md-12"},X=o("label",{for:"",class:"text-weight-semi-bold"},"Tel\xE9fono",-1),x=o("label",{for:"",class:"text-weight-semi-bold"},"Contrase\xF1a",-1),ee=o("label",{for:"",class:"text-weight-semi-bold"},"Repetir contrase\xF1a",-1),se=o("label",{for:"",class:"text-weight-semi-bold"},"Permisos",-1);function ae(s,a,n,m,t,i){return y(),I(B,{class:"row",onSubmit:s.doSaveUser},{default:g(()=>[o("div",{class:d(["col-12 col-md-6",{"q-pr-sm":s.$q.screen.gt.sm}])},[G,l(b,{dense:"",modelValue:s.user.name,"onUpdate:modelValue":a[0]||(a[0]=e=>s.user.name=e),placeholder:"Ingrese su nombre completo",outlined:"",rounded:"",rules:[e=>!!e||"Este campo es requerido",e=>e.length<60||"60 caracteres maximos",e=>/^[a-zA-Z\s]+$/.test(e)||"Ingresa un nombre valido"]},null,8,["modelValue","rules"])],2),o("div",{class:d(["col-12 col-md-6",{"q-pl-sm":s.$q.screen.gt.sm}])},[Y,l(b,{dense:"",modelValue:s.user.last_name,"onUpdate:modelValue":a[1]||(a[1]=e=>s.user.last_name=e),placeholder:"Ingrese su nombre completo",outlined:"",rounded:"",rules:[e=>!!e||"Este campo es requerido",e=>e.length<60||"60 caracteres maximos",e=>/^[a-zA-Z\s]+$/.test(e)||"Ingresa un nombre valido"]},null,8,["modelValue","rules"])],2),o("div",{class:d(["col-12 col-md-6",{"q-pr-sm":s.$q.screen.gt.sm}])},[J,l(k,{"emit-value":"","map-options":"",dense:"",modelValue:s.user.role,"onUpdate:modelValue":a[2]||(a[2]=e=>s.user.role=e),label:"Seleccione un tipo de usuario",options:s.typeUsers,outlined:"",rounded:"",rules:[e=>!!e||"Este campo es requerido"]},null,8,["modelValue","options","rules"])],2),o("div",{class:d(["col-12 col-md-6",{"q-pl-sm":s.$q.screen.gt.sm}])},[K,l(b,{dense:"",modelValue:s.user.email,"onUpdate:modelValue":a[3]||(a[3]=e=>s.user.email=e),placeholder:"Ingrese su correo electr\xF3nico",outlined:"",rounded:"",rules:[e=>!!e||"Este campo es requerido",e=>/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(e)||"Ingresa un correo electr\xF3nico valido"]},null,8,["modelValue","rules"])],2),o("div",W,[X,l(b,{dense:"",modelValue:s.user.phone,"onUpdate:modelValue":a[4]||(a[4]=e=>s.user.phone=e),placeholder:"Ingrese un numero telef\xF3nico",outlined:"",rounded:"",rules:[e=>/^\d{1,3}\d{1,14}$/.test(e)||"Ingresa un n\xFAmero valido",e=>!!e||"Este campo es requerido",e=>e.length<15||"15 caracteres maximos"]},null,8,["modelValue","rules"])]),o("div",{class:d(["col-12 col-md-6",{"q-pr-sm":s.$q.screen.gt.sm}])},[x,l(b,{dense:"",type:s.showPassword?"text":"password",modelValue:s.user.password,"onUpdate:modelValue":a[6]||(a[6]=e=>s.user.password=e),placeholder:"Ingrese una contrase\xF1a segura",outlined:"",rounded:"",rules:s.user.password&&s.user.password.length>0?[e=>!!e||"Este campo es requerido",e=>/^(?=.*[A-Z])(?=.*[a-z])(?=.*\d)(?=.*[$@#&!*-])[A-Za-z\d$@#&!*-]{8,}$/.test(e)||"Ingresa una contrase\xF1a valida"]:[]},{append:g(()=>[l(U,{onClick:a[5]||(a[5]=e=>s.showPassword=!s.showPassword),flat:"",dense:"",rounded:"",icon:"img:images/eyegreen.svg"})]),_:1},8,["type","modelValue","rules"])],2),o("div",{class:d(["col-12 col-md-6",{"q-pl-sm":s.$q.screen.gt.sm}])},[ee,l(b,{dense:"",type:s.showPassword?"text":"password",modelValue:s.user.confirmation_password,"onUpdate:modelValue":a[8]||(a[8]=e=>s.user.confirmation_password=e),placeholder:"Repita la contrase\xF1a previamente ingresada",outlined:"",rounded:"",rules:s.user.password&&s.user.password.length>0?[e=>e===s.user.password||"No coinciden las contrase\xF1as",e=>!!e||"Este campo es requerido",e=>/^(?=.*[A-Z])(?=.*[a-z])(?=.*\d)(?=.*[$@#&!*-])[A-Za-z\d$@#&!*-]{8,}$/.test(e)||"Ingresa una contrase\xF1a valida"]:[]},{append:g(()=>[l(U,{onClick:a[7]||(a[7]=e=>s.showPassword=!s.showPassword),flat:"",dense:"",rounded:"",icon:"img:images/eyegreen.svg"})]),_:1},8,["type","modelValue","rules"])],2),o("div",{class:d(["col-12",{"q-mt-md":!s.user.password}])},[se,l(L,{inline:"",modelValue:s.user.scopes,"onUpdate:modelValue":a[9]||(a[9]=e=>s.user.scopes=e),options:s.scopes,color:"primary",type:"checkbox"},null,8,["modelValue","options"])],2),o("div",{class:d(["col-12 col-md-6 q-mt-xl",{"q-pr-sm":s.$q.screen.gt.sm}])},[S(l(U,{label:"Cancelar",color:"info","no-caps":"",rounded:"",outline:"",class:"full-width"},null,512),[[_]])],2),o("div",{class:d(["col-12 col-md-6 q-mt-xl",{"q-pl-sm":s.$q.screen.gt.sm}])},[l(U,{loading:s.loading,type:"submit",unelevated:"",label:s.user._id?"Editar usuario":"Crear usuario",color:"primary","no-caps":"",rounded:"",class:"full-width"},null,8,["loading","label"])],2)]),_:1},8,["onSubmit"])}var oe=A(j,[["render",ae]]);const le=E({name:"UserMainComponent",components:{formUser:oe,modalCard:H,HeaderComponent:N,TableAsiati:R},setup(){const s=O(),a=c(!0),n=c({name:"",last_name:"",email:"",phone:"",role:v.CEO,scopes:[],is_active:!0,username:"",password:""}),m=c([{name:"name",align:"left",sortable:!1,label:"Nombre",field:r=>`${r.name} ${r.last_name}`},{name:"userType",align:"left",sortable:!1,field:r=>`${r.role}`,label:"Tipo usuario"},{name:"email",align:"left",sortable:!1,field:r=>`${r.email||"-"}`,label:"Correo"},{name:"phone",align:"left",sortable:!1,label:"Tel\xE9fono",field:r=>`${r.phone||"-"}`},{name:"option",align:"center",sortable:!1,label:""}]),t=F(),i=c(!1),e=M(()=>t.users),w=M(()=>t.totalItems),$=()=>{i.value=!i.value,n.value={name:"",last_name:"",email:"",phone:"",role:v.CEO,scopes:[],is_active:!0,username:"",password:""}},h=async()=>{try{const r=s.query.page||1,p=s.query.search||"",q=s.query.perPage||12,P=`?page=${r}&search=${p}&perPage=${q}`;await t.doListUsers(P)}catch{}},f=async r=>{try{(await t.doDeleteUser(r)).success&&V("positive","Usuario eliminado","primary")}catch{}},u=r=>{const p=t.users.find(q=>q._id===r);p&&typeof p=="object"&&(n.value=p,n.value.password="",i.value=!0)};return D(async()=>{await h()}),{rows:m,user:n,users:e,doEdit:u,render:a,openModal:$,deleteUser:f,totalItems:w,openModalUser:i}}}),re={class:"full-width"};function te(s,a,n,m,t,i){const e=C("HeaderComponent"),w=C("TableAsiati"),$=C("form-user"),h=C("modalCard");return y(),Q("section",re,[l(e,{permission:"create-users",title:"Usuarios",btnLabel:"Agregar usuario",onOpenModal:s.openModal},null,8,["onOpenModal"]),s.render?(y(),I(w,{key:0,"permission-edit":"edit-users","permission-delete":"delete-users",rows:s.rows,columns:s.users,"total-items":s.totalItems,onDoDelete:s.deleteUser,onDoEdit:s.doEdit},null,8,["rows","columns","total-items","onDoDelete","onDoEdit"])):T("",!0),l(Z,{modelValue:s.openModalUser,"onUpdate:modelValue":a[0]||(a[0]=f=>s.openModalUser=f)},{default:g(()=>[l(h,{title:s.user._id?"Editar usuario":"Usuario nuevo"},{body:g(()=>[l($,{userData:s.user,onCloseModal:s.openModal},null,8,["userData","onCloseModal"])]),_:1},8,["title"])]),_:1},8,["modelValue"])])}var ne=A(le,[["render",te]]);const ie=E({name:"UsersPage",components:{UserMain:ne}});function ue(s,a,n,m,t,i){const e=C("user-main");return y(),I(z,{padding:""},{default:g(()=>[l(e)]),_:1})}var Ue=A(ie,[["render",ue]]);export{Ue as default};
