import{Q as I,a as F}from"./QForm.e9176afe.js";import{Y as q,r as g,e as $,aj as D,_ as w,$ as V,a0 as S,a1 as v,af as r,a2 as l,ag as C,az as c,F as P,ah as M,ai as Q,a5 as y,ae as B,am as N,b6 as O}from"./index.d29c8e76.js";import{b as U,c as R,C as T,H as A,m as H}from"./QTable.525c7713.js";import{u as L}from"./users.b07f86dd.js";import{notification as h}from"./notification.ebb7e7a1.js";import{T as j}from"./tableAsiati.79bd0b79.js";import"./QList.a8cf2929.js";import"./auth.bb8238f6.js";const k=q({name:"CompaniesFormComponent",emits:["close-modal"],props:{companyData:{type:Object,defautl:()=>({})}},setup(e,{emit:s}){const n=g({name:"",url:"",responsable:"",meta_app_secret:"",meta_app_identifier:""}),m=L(),t=g(!1),p=U(),a=$(()=>m.users.map(o=>({label:`${o.name} ${o.last_name}`,value:o._id}))),u=async()=>{if(t.value=!0,n.value._id)return await b(),!0;try{const o=await p.doSaveCompany(n.value);o.success&&(h("positive",o.message,"primary"),s("close-modal"),d())}catch{}finally{t.value=!1}},d=()=>{n.value={name:"",url:"",responsable:"",meta_app_secret:"",meta_app_identifier:""}},f=async()=>{try{await m.listForSelect()}catch{}},b=async()=>{try{const o=await p.doUpdateCompany(n.value);o.success&&(h("positive",o.message,"primary"),s("close-modal"),d())}catch{}finally{t.value=!1}};return D(async()=>{await f(),e.companyData&&e.companyData._id&&(n.value=JSON.parse(JSON.stringify(e.companyData)),n.value.responsable=e.companyData.responsable._id)}),{users:a,company:n,loading:t,doSaveUser:u}}}),z=r("label",{for:"",class:"text-weight-semi-bold"},"Nombre de la tienda",-1),J=r("label",{for:"",class:"text-weight-semi-bold"},"Responsable",-1),Y=r("label",{for:"",class:"text-weight-semi-bold"},"URL",-1),G=r("label",{for:"",class:"text-weight-semi-bold"},"Identificador meta",-1),K={class:"col-12"},W=r("label",{for:"",class:"text-weight-semi-bold"},"Clave secreta meta",-1);function X(e,s,n,m,t,p){return V(),S(I,{class:"row",onSubmit:e.doSaveUser},{default:v(()=>[r("div",{class:c(["col-12 col-md-6",{"q-pr-sm":e.$q.screen.gt.sm}])},[z,l(C,{dense:"",modelValue:e.company.name,"onUpdate:modelValue":s[0]||(s[0]=a=>e.company.name=a),placeholder:"Ingrese un nombre",outlined:"",rounded:"",rules:[a=>!!a||"Este campo es requerido",a=>a.length<90||"90 caracteres maximos",a=>/^[^';]+$/.test(a)||"Ingresa un nombre valido"]},null,8,["modelValue","rules"])],2),r("div",{class:c(["col-12 col-md-6",{"q-pl-sm":e.$q.screen.gt.sm}])},[J,l(R,{"emit-value":"","map-options":"",dense:"",modelValue:e.company.responsable,"onUpdate:modelValue":s[1]||(s[1]=a=>e.company.responsable=a),label:"Seleccione un responsable",options:e.users,outlined:"",rounded:"",rules:[a=>!!a||"Este campo es requerido"]},null,8,["modelValue","options","rules"])],2),r("div",{class:c(["col-12 col-md-6",{"q-pr-sm":e.$q.screen.gt.sm}])},[Y,l(C,{dense:"",modelValue:e.company.url,"onUpdate:modelValue":s[2]||(s[2]=a=>e.company.url=a),placeholder:"Ingrese un nombre",outlined:"",rounded:"",rules:[a=>!!a||"Este campo es requerido",a=>a.length<250||"250 caracteres maximos",a=>/^(https?|ftp):\/\/[^\s/$.?#].[^\s]*$/.test(a)||"Ingresa una url valida"]},null,8,["modelValue","rules"])],2),r("div",{class:c(["col-12 col-md-6",{"q-pl-sm":e.$q.screen.gt.sm}])},[G,l(C,{dense:"",modelValue:e.company.meta_app_identifier,"onUpdate:modelValue":s[3]||(s[3]=a=>e.company.meta_app_identifier=a),placeholder:"Ingrese su nombre completo",outlined:"",rounded:"",rules:[a=>!!a||"Este campo es requerido",a=>a.length<90||"90 caracteres maximos"]},null,8,["modelValue","rules"])],2),r("div",K,[W,l(C,{dense:"",modelValue:e.company.meta_app_secret,"onUpdate:modelValue":s[4]||(s[4]=a=>e.company.meta_app_secret=a),placeholder:"Ingrese su nombre completo",outlined:"",rounded:"",rules:[a=>!!a||"Este campo es requerido",a=>a.length<500||"500 caracteres maximos"]},null,8,["modelValue","rules"])]),r("div",{class:c(["col-12 col-md-6 q-mt-xl",{"q-pr-sm":e.$q.screen.gt.sm}])},[P(l(M,{label:"Cancelar",color:"info","no-caps":"",rounded:"",outline:"",class:"full-width"},null,512),[[T]])],2),r("div",{class:c(["col-12 col-md-6 q-mt-xl",{"q-pl-sm":e.$q.screen.gt.sm}])},[l(M,{loading:e.loading,type:"submit",unelevated:"",label:e.company._id?"Editar tienda":"Crear tienda",color:"primary","no-caps":"",rounded:"",class:"full-width"},null,8,["loading","label"])],2)]),_:1},8,["onSubmit"])}var Z=w(k,[["render",X]]);const x=q({name:"CompaniesMainComponent",components:{HeaderComponent:A,TableAsiati:j,CompaniesForm:Z,ModalCard:H},setup(){const e=Q(),s=g([{name:"name",align:"left",sortable:!1,label:"Nombre tienda",field:o=>`${o.name}`},{name:"url",align:"left",sortable:!1,label:"URL",field:o=>`${o.url}`},{name:"name",align:"left",sortable:!1,label:"Responsable",field:o=>o.responsable?`${o.responsable.name} ${o.responsable.last_name}`:"-"},{name:"option",align:"center",sortable:!1,label:""}]),n=g({name:"",url:"",responsable:"",meta_app_secret:"",meta_app_identifier:""}),m=U(),t=g(!1),p=$(()=>m.companies),a=$(()=>m.totalItems),u=()=>{t.value=!t.value,n.value={name:"",url:"",responsable:"",meta_app_secret:"",meta_app_identifier:""}},d=o=>{const i=m.companies.find(_=>_._id===o);i&&typeof i=="object"&&(n.value=i,t.value=!0)},f=async o=>{try{const i=await m.doDeleteCompany(o);i.success&&h("positive",i.message,"primary")}catch{}},b=async()=>{try{const o=e.query.page||1,i=e.query.search||"",_=e.query.perPage||12,E=`?page=${o}&search=${i}&perPage=${_}`;await m.doListCompanies(E)}catch{}};return D(async()=>{await b()}),{rows:s,doEdit:d,company:n,doDelete:f,openModal:u,companies:p,totalItems:a,openModalCompanies:t}}});function ee(e,s,n,m,t,p){const a=y("HeaderComponent"),u=y("TableAsiati"),d=y("CompaniesForm"),f=y("ModalCard");return V(),B(O,null,[l(a,{permission:"create-business",title:"Mis tiendas",btnLabel:"Agregar tienda",onOpenModal:e.openModal},null,8,["onOpenModal"]),l(u,{"permission-edit":"edit-business","permission-delete":"delete-business",rows:e.rows,columns:e.companies,"total-items":e.totalItems,onDoDelete:e.doDelete,onDoEdit:e.doEdit},null,8,["rows","columns","total-items","onDoDelete","onDoEdit"]),l(N,{modelValue:e.openModalCompanies,"onUpdate:modelValue":s[0]||(s[0]=b=>e.openModalCompanies=b)},{default:v(()=>[l(f,{title:e.company._id?"Editar tienda":"Tienda nueva"},{body:v(()=>[l(d,{onCloseModal:e.openModal,companyData:e.company},null,8,["onCloseModal","companyData"])]),_:1},8,["title"])]),_:1},8,["modelValue"])],64)}var ae=w(x,[["render",ee]]);const oe=q({name:"CompaniesPage",components:{MainCompanies:ae}});function se(e,s,n,m,t,p){const a=y("MainCompanies");return V(),S(F,{padding:""},{default:v(()=>[l(a)]),_:1})}var ce=w(oe,[["render",se]]);export{ce as default};
