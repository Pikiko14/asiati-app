import{Q}from"./QPage.715d6872.js";import{d as F,r as m,Y as q,a7 as S,_,$ as y,a0 as M,a1 as h,a6 as u,a2 as d,a8 as C,a9 as v,F as H,aa as D,ab as O,e as V,ac as P,aC as L,a5 as k,ad as A}from"./index.2f0c4fae.js";import{Q as T}from"./QForm.57d357f4.js";import{C as j,M as J}from"./modalCard.e7fdc3b5.js";import{R as z}from"./auth.b49303b4.js";import{notification as w}from"./notification.c42bd851.js";import{U as G}from"./utils.528ba315.js";import{H as Y}from"./headers.e2e63168.js";import{T as K}from"./tableAsiati.ccdc534d.js";import"./QTable.93a07d92.js";import"./use-quasar.13bf5623.js";const $="products",b=new z({Accept:"application/json"}),U=F("productsStore",()=>{const e=m(0),s=m([]);return{products:s,totalItems:e,doSaveProduct:async o=>{try{const t=await b.doPostRequest(`${$}`,o,!0,!1);if(t.success)return s.value.push(t.data),e.value++,t}catch(t){console.log(t)}},doListProducts:async o=>{try{const t=await b.doGetRequest(`${$}`,o,!0);if(t.success)return s.value=t.data.products,e.value=t.data.totalItems,t}catch(t){console.log(t)}},doDeleteProduct:async o=>{try{const t=await b.doDeleteRequest(`${$}/${o}`,!0);if(t.success){const a=s.value.findIndex(p=>p._id===o);return a!==-1&&(s.value.splice(a,1),e.value--),t}}catch{}},doUpdateProducts:async o=>{try{const t=await b.doPutRequest(`${$}/${o._id}`,o,!0,!1);if(t.success){const a=s.value.findIndex(p=>p._id===o._id);return a!==-1&&(s.value[a]=t.data),t}}catch{}}}}),W=q({name:"FormProductComponent",emits:["close-modal"],props:{productData:{type:Object,default:()=>({})}},setup(e,{emit:s}){const{productData:c}=e,i=U(),n=m(!1),r=m({name:"",value:0,iva:0}),o=async()=>{if(r.value._id)return await t(),!1;try{n.value=!0;const a=await i.doSaveProduct(r.value);a.success&&(w("positive",a.message,"primary"),s("close-modal"))}catch{}finally{n.value=!1}},t=async()=>{try{n.value=!0;const a=await i.doUpdateProducts(r.value);a.success&&(w("positive",a.message,"primary"),s("close-modal"))}catch{}finally{n.value=!1}};return S(()=>{c._id&&(r.value=JSON.parse(JSON.stringify(c)))}),{product:r,loading:n,doSaveProduct:o}}}),X=u("label",{for:"",class:"text-weight-semi-bold"},"Nombre del producto",-1),Z=u("label",{for:"",class:"text-weight-semi-bold"},"Costo del producto",-1),x=u("label",{for:"",class:"text-weight-semi-bold"},"Iva",-1),ee=u("br",null,null,-1);function oe(e,s,c,i,n,r){return y(),M(T,{onSubmit:e.doSaveProduct,class:"row product-form"},{default:h(()=>[u("div",{class:v(["col-12",{"q-pr-sm":e.$q.screen.gt.sm}])},[X,d(C,{dense:"",modelValue:e.product.name,"onUpdate:modelValue":s[0]||(s[0]=o=>e.product.name=o),modelModifiers:{string:!0},placeholder:"Cocacola 1Lt",outlined:"",rounded:"",rules:[o=>!!o||"Este campo es requerido",o=>o.length<90||"90 caracteres maximos"]},null,8,["modelValue","rules"])],2),u("div",{class:v(["col-12",{"q-pr-sm":e.$q.screen.gt.sm}])},[Z,d(C,{dense:"",modelValue:e.product.value,"onUpdate:modelValue":s[1]||(s[1]=o=>e.product.value=o),modelModifiers:{number:!0},placeholder:"15000",outlined:"",rounded:"",rules:[o=>!!o||"Este campo es requerido"]},null,8,["modelValue","rules"])],2),u("div",{class:v(["col-12",{"q-pr-sm":e.$q.screen.gt.sm}])},[x,ee,d(C,{outlined:"",rounded:"",dense:"",style:{"margin-left":"-8px"},type:"number",modelValue:e.product.iva,"onUpdate:modelValue":s[2]||(s[2]=o=>e.product.iva=o),label:"Impuesto",rules:[o=>!!o||"Este campo es requerido"]},null,8,["modelValue","rules"])],2),u("div",{class:v(["col-12 col-md-6 q-mt-xl",{"q-pr-sm":e.$q.screen.gt.sm}])},[H(d(D,{label:"Cancelar",color:"info","no-caps":"",rounded:"",outline:"",class:"full-width"},null,512),[[j]])],2),u("div",{class:v(["col-12 col-md-6 q-mt-xl",{"q-pl-sm":e.$q.screen.gt.sm}])},[d(D,{loading:e.loading,type:"submit",unelevated:"",label:e.product._id?"Editar product":"Crear producto",color:"primary","no-caps":"",rounded:"",class:"full-width"},null,8,["loading","label"])],2)]),_:1},8,["onSubmit"])}var te=_(W,[["render",oe]]);const se=q({name:"ProductMainComponent",components:{ModalCard:J,FormProduct:te,HeaderComponent:Y,TableAsiati:K},setup(){const e=O(),s=U(),c=m(!0),i=new G("products"),n=m({name:"",value:0,iva:0}),r=m(!1),o=m([{name:"name",align:"left",sortable:!1,label:"Nombre",field:l=>`${l.name}`},{name:"value",align:"right",sortable:!1,field:l=>`${i.formatPrice(l.value)}`,label:"Costo (COP)"},{name:"is_health_and_wellness",align:"center",sortable:!1,field:l=>`${l.iva}%`,label:"Impuesto"},{name:"option",align:"center",sortable:!1,label:""}]),t=V(()=>s.products),a=V(()=>s.totalItems),p=()=>{n.value={name:"",value:0,iva:0}},g=()=>{r.value=!r.value,r.value||p()},I=async()=>{try{const l=e.query.page||1,f=e.query.search||"",R=e.query.perPage||12,N=`?page=${l}&search=${f}&perPage=${R}`;await s.doListProducts(N)}catch{}},E=l=>{n.value=t.value.find(f=>f._id===l),g()},B=async l=>{try{const f=await s.doDeleteProduct(l);f.success&&w("positive",f.message,"primary")}catch{}};return S(async()=>{await I()}),{rows:o,render:c,doEdit:E,product:n,products:t,openModal:g,clearData:p,totalItems:a,deleteUser:B,openModalProducts:r}}}),ae={class:"full-width"};function re(e,s,c,i,n,r){const o=P("HeaderComponent"),t=P("TableAsiati"),a=P("FormProduct"),p=P("ModalCard");return y(),L("section",ae,[d(o,{permission:"create-products",title:"Productos",btnLabel:"Crear producto",onOpenModal:e.openModal},null,8,["onOpenModal"]),e.render?(y(),M(t,{key:0,"permission-edit":"edit-users","permission-delete":"delete-products",rows:e.rows,columns:e.products,"total-items":e.totalItems,onDoDelete:e.deleteUser,onDoEdit:e.doEdit},null,8,["rows","columns","total-items","onDoDelete","onDoEdit"])):k("",!0),d(A,{modelValue:e.openModalProducts,"onUpdate:modelValue":s[0]||(s[0]=g=>e.openModalProducts=g),onBeforeHide:e.clearData},{default:h(()=>[d(p,{title:e.product._id?"Editar product":"Producto nuevo"},{body:h(()=>[d(a,{onCloseModal:e.openModal,productData:e.product},null,8,["onCloseModal","productData"])]),_:1},8,["title"])]),_:1},8,["modelValue","onBeforeHide"])])}var ne=_(se,[["render",re]]);const le=q({name:"ProductPage",components:{ProductMainComponent:ne}});function de(e,s,c,i,n,r){const o=P("ProductMainComponent");return y(),M(Q,{padding:""},{default:h(()=>[d(o)]),_:1})}var ye=_(le,[["render",de]]);export{ye as default};
