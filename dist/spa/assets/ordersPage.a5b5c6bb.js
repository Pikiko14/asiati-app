import{Q as A}from"./QPage.715d6872.js";import{d as k,r as b,Y as v,e as q,a7 as F,_ as w,$ as D,aC as C,a2 as l,a1 as h,a6 as t,F as H,aa as S,a9 as E,ar as n,a4 as M,ab as L,ac as $,ad as T,a0 as N}from"./index.2f0c4fae.js";import{U as I}from"./utils.528ba315.js";import{Q as j}from"./QFile.13f5ae2c.js";import{u as G,a as V,H as z}from"./headers.e2e63168.js";import{Q as X}from"./QForm.57d357f4.js";import{C as Y,M as J}from"./modalCard.e7fdc3b5.js";import{R as K}from"./auth.b49303b4.js";import{notification as W}from"./notification.c42bd851.js";import{Q as O}from"./QTable.93a07d92.js";import{T as Z}from"./tableAsiati.ccdc534d.js";import"./use-quasar.13bf5623.js";const P="orders",x=new K({Accept:"application/json"}),Q=k("ordersStore",()=>{const e=b([]),r=b(0);return{orders:e,totalItems:r,doListOrders:async d=>{try{const a=await x.doGetRequest(`${P}`,d,!0);if(a.success)return e.value=a.data.companies,r.value=a.data.totalItems,a}catch{}},doImportOrders:async d=>{try{const a=await x.doPostRequest(`${P}/import`,d,!0,!0);if(a.success)return a}catch{}}}}),ee=v({name:"ImportOrdersComponent",emits:["close-modal"],setup(e,{emit:r}){const p=new I("orders"),u=Q(),d=b(!1),a=b({file:null,company:null,type:null}),s=G(),_=["Dropi","Shopify"],i=q(()=>s.companies.length>0?s.companies.map(c=>({label:`${c.name}`,value:c._id})):[]),f=async()=>{try{await s.listForSelect()}catch{}},y=async()=>{try{d.value=!0;const c=p.transformObjectInFormData(a.value,!1,null),g=await u.doImportOrders(c);g&&g.success&&(W("positive",g.message,"primary"),r("close-modal"))}catch{}finally{d.value=!1}};return F(async()=>{i.value.length>0||await f()}),{order:a,loading:d,companies:i,typeOrder:_,doImportOrders:y}}}),te={class:"full-width"},oe={class:"col-12"},se=t("label",{for:"",class:"text-weight-semi-bold"},"Archivo excel",-1),re={class:"col-12"},ae=t("label",{for:"",class:"text-weight-semi-bold"},"Tienda",-1),le={class:"col-12"},ne=t("label",{for:"",class:"text-weight-semi-bold"},"Tipo ecommerce",-1);function de(e,r,p,u,d,a){return D(),C("div",te,[l(X,{class:"row full-width",onSubmit:e.doImportOrders},{default:h(()=>[t("div",oe,[se,l(j,{dense:"",modelValue:e.order.file,"onUpdate:modelValue":r[0]||(r[0]=s=>e.order.file=s),label:"Selecciona un archivo",outlined:"",rounded:"",rules:[s=>!!s||"Este campo es requerido"]},null,8,["modelValue","rules"])]),t("div",re,[ae,l(V,{options:e.companies,"map-options":"","emit-value":"",dense:"",modelValue:e.order.company,"onUpdate:modelValue":r[1]||(r[1]=s=>e.order.company=s),label:"Selecciona la tienda",outlined:"",rounded:"",rules:[s=>!!s||"Este campo es requerido"]},null,8,["options","modelValue","rules"])]),t("div",le,[ne,l(V,{options:e.typeOrder,"map-options":"","emit-value":"",dense:"",modelValue:e.order.type,"onUpdate:modelValue":r[2]||(r[2]=s=>e.order.type=s),label:"Selecciona un archivo",outlined:"",rounded:"",rules:[s=>!!s||"Este campo es requerido"]},null,8,["options","modelValue","rules"])]),t("div",{class:E(["col-12 col-md-6 q-mt-xl",{"q-pr-sm":e.$q.screen.gt.sm}])},[H(l(S,{label:"Cancelar",color:"info","no-caps":"",rounded:"",outline:"",class:"full-width"},null,512),[[Y]])],2),t("div",{class:E(["col-12 col-md-6 q-mt-xl",{"q-pl-sm":e.$q.screen.gt.sm}])},[l(S,{loading:e.loading,type:"submit",unelevated:"",label:"Importar",color:"primary","no-caps":"",rounded:"",class:"full-width"},null,8,["loading"])],2)]),_:1},8,["onSubmit"])])}var ie=w(ee,[["render",de]]);const ce=v({name:"DetailOrdersComponent",props:{order:{type:Object,default:()=>({})}},setup(){return{utils:new I("oders")}}}),ue={class:"full-weidth row"},me={class:"col-12"},pe=t("thead",null,[t("tr",null,[t("th",{class:"text-left"},"Fecha"),t("th",{class:"text-left"},"Tel\xE9fono"),t("th",{class:"text-center"},"# Gu\xEDa"),t("th",{class:"text-center"},"Estado gu\xEDa")])],-1),fe={class:"text-left"},he={class:"text-left"},_e={class:"text-center"},be={class:"text-center"},ge=t("thead",null,[t("tr",null,[t("th",{class:"text-left"},"Departamento"),t("th",{class:"text-left"},"Ciudad"),t("th",{class:"text-left"},"Transportadora"),t("th",{class:"text-left"},"Tienda")])],-1),$e={class:"text-left"},ye={class:"text-left"},ve={class:"text-left"},we={class:"text-left"},De={class:"col-12 q-mt-md"},Oe=t("span",{class:"font-12 text-primary text-weight-bold text-primary"},"Productos:",-1),qe={class:"col-12 q-mt-md"},Ce=t("span",{class:"font-12 text-primary text-weight-bold text-primary"},"Nota:",-1),Ie={class:"col-12 q-mt-md"},Se=t("thead",null,[t("tr",null,[t("th",{class:"text-center"},"Total env\xEDo"),t("th",{class:"text-center"},"Total orden"),t("th",{class:"text-center"},"Total devoluci\xF3n"),t("th",{class:"text-center"},"Total ganancia")])],-1),Ee={class:"text-center"},Me={class:"text-center"},Te={class:"text-center"},Ve={class:"text-center"};function Pe(e,r,p,u,d,a){var s,_;return D(),C("div",ue,[t("div",me,[l(O,{class:"q-pa-none shadow-0"},{default:h(()=>{var i,f;return[pe,t("tbody",null,[t("tr",null,[t("td",fe,n(e.order.date_order),1),t("td",he,n(e.order.phone),1),t("td",_e,n((i=e.order.guide_number)!=null?i:"Sin gu\xEDa"),1),t("td",be,n((f=e.order.guide_status)!=null?f:"Sin gu\xEDa"),1)])])]}),_:1}),l(O,{class:"q-pa-none shadow-0 q-mt-md"},{default:h(()=>{var i;return[ge,t("tbody",null,[t("tr",null,[t("td",$e,n(e.order.province),1),t("td",ye,n(e.order.city),1),t("td",ve,n(e.order.order_conveyor),1),t("td",we,n((i=e.order.company)==null?void 0:i.name),1)])])]}),_:1})]),t("div",De,[Oe,M(" "+n((s=e.order)==null?void 0:s.products)+" | X "+n(e.order.quantity)+" Und ",1)]),t("div",qe,[Ce,M(" "+n((_=e.order)==null?void 0:_.order_notes),1)]),t("div",Ie,[l(O,{class:"q-pa-none shadow-0 q-mt-md"},{default:h(()=>[Se,t("tbody",null,[t("tr",null,[t("td",Ee,n(e.utils.formatPrice(parseInt(e.order.freight_price))),1),t("td",Me,n(e.utils.formatPrice(parseInt(e.order.total_order))),1),t("td",Te,n(e.order.return_freight_cost>0?e.utils.formatPrice(parseInt(e.order.return_freight_cost)):"$0"),1),t("td",Ve,n(e.order.order_profit>0?e.utils.formatPrice(parseInt(e.order.order_profit)):"$0"),1)])])]),_:1})])])}var xe=w(ce,[["render",Pe]]);const Fe=v({name:"OrdersMainComponent",components:{modalCard:J,importForm:ie,detailOrder:xe,TableAsiati:Z,HeaderComponent:z},setup(){const e=[{name:"external_id",align:"left",sortable:!1,label:"Id externo",field:o=>`${o.external_id?o.external_id:"-"}`},{name:"company",align:"left",sortable:!1,label:"Tienda",field:o=>{var m;return`${(m=o.company)!=null&&m.name?o.company.name:"-"}`}},{name:"date",align:"left",sortable:!1,label:"Fecha",field:o=>{var m;return`${(m=o.date_order)==null?void 0:m.substring(0,10)}`}},{name:"phone",align:"left",sortable:!1,label:"Tel\xE9fono",field:o=>`${o.phone?o.phone:"-"}`},{name:"guide_number",align:"left",sortable:!1,label:"# Gu\xEDa",field:o=>`${o.guide_number?o.guide_number:"-"}`},{name:"guide_status",align:"left",sortable:!1,label:"Estado gu\xEDa",field:o=>`${o.guide_status?o.guide_status:"-"}`},{name:"products",align:"left",sortable:!1,label:"Productos",field:o=>`${o.products?o.products:"-"}`},{name:"freight_value",align:"center",sortable:!1,label:"Costo env\xEDo",field:o=>`${o.freight_price?d.formatPrice(o.freight_price):"-"}`},{name:"total_order",align:"center",sortable:!1,label:"Total orden",field:o=>`${d.formatPrice(o.total_order)}`},{name:"quantity_orders_shopify",align:"center",sortable:!1,label:"Cantidad ordenes",field:o=>{var m;return`${(m=o.quantity_order)!=null?m:"-"}`}},{name:"option",align:"center",sortable:!1,label:""}],r=L(),p=b({}),u=Q(),d=new I("orders"),a=b(!1),s=b(!1),_=q(()=>u.orders),i=q(()=>u.totalItems),f=async()=>{a.value=!a.value,a.value||await g()},y=o=>{alert(o)},c=o=>{alert(o)},g=async()=>{try{const o=r.query.page||1,m=r.query.search||"",B=r.query.perPage||12,R=`?page=${o}&search=${m}&perPage=${B}`;await u.doListOrders(R)}catch{}},U=o=>{p.value=o,s.value=!s.value};return F(async()=>{await g()}),{rows:e,order:p,doEdit:c,doShow:U,orders:_,doDelete:y,openModal:f,totalItems:i,openModalImport:a,openOrderDetail:s}}}),Qe={class:"full-width"};function Ue(e,r,p,u,d,a){const s=$("HeaderComponent"),_=$("TableAsiati"),i=$("importForm"),f=$("modalCard"),y=$("detailOrder");return D(),C("section",Qe,[l(s,{permission:"create-users",title:"Ordenes",btnLabel:"Importar",onOpenModal:e.openModal},null,8,["onOpenModal"]),l(_,{"permission-edit":"edit-orders",permissionShow:"list-orders","permission-delete":"delete-orders",rows:e.rows,columns:e.orders,"total-items":e.totalItems,onDoDelete:e.doDelete,onDoEdit:e.doEdit,onDoShow:e.doShow},null,8,["rows","columns","total-items","onDoDelete","onDoEdit","onDoShow"]),l(T,{modelValue:e.openModalImport,"onUpdate:modelValue":r[0]||(r[0]=c=>e.openModalImport=c)},{default:h(()=>[l(f,{title:"Importar ordenes"},{body:h(()=>[l(i,{onCloseModal:e.openModal},null,8,["onCloseModal"])]),_:1})]),_:1},8,["modelValue"]),l(T,{modelValue:e.openOrderDetail,"onUpdate:modelValue":r[1]||(r[1]=c=>e.openOrderDetail=c)},{default:h(()=>[l(f,{title:`Detalles de la orden ${e.order._id?e.order.external_id:""}`},{body:h(()=>[l(y,{order:e.order},null,8,["order"])]),_:1},8,["title"])]),_:1},8,["modelValue"])])}var Be=w(Fe,[["render",Ue]]);const Re=v({name:"UsersPage",components:{OrdersMain:Be}});function Ae(e,r,p,u,d,a){const s=$("OrdersMain");return D(),N(A,{padding:""},{default:h(()=>[l(s)]),_:1})}var Ze=w(Re,[["render",Ae]]);export{Ze as default};
