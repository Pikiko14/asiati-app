import{Q as z,a as O}from"./QForm.e2f3665f.js";import{Y as E,r as c,aj as F,_ as A,$ as C,a0 as I,a1 as g,af as a,a2 as r,ag as v,az as u,ah as U,be as S,F as T,ai as Z,e as D,a5 as y,ae as N,a4 as Q,am as k}from"./index.14ee5053.js";import{c as B,C as L,m as _,H}from"./QTable.976bda8f.js";import{u as M}from"./users.8d3cedcd.js";import{notification as V}from"./notification.517053fe.js";import{T as j}from"./tableAsiati.d1f0b972.js";import"./QList.526f9656.js";import"./auth.9701980b.js";var f=(e=>(e.ADMIN="admin",e.CEO="ceo",e))(f||{});const R=E({name:"UserFormComponent",emits:["close-modal"],props:{userData:{type:Object,default:()=>({})}},setup(e,{emit:o}){const t=[{label:"Administrador",value:f.ADMIN},{label:"Ceo",value:f.CEO}],m=M(),n=c(!1),i=c(!1),s=c({username:"",password:"",email:"",role:f.CEO,scopes:["create-users","list-users","edit-users","delete-users","create-business","list-business","edit-business","delete-business","list-meta-metric","list-orders","import-orders","list-orders","import-orders"],is_active:!0,name:"",last_name:"",confirmation_password:"",phone:""}),w=[{label:"Crear usuarios",value:"create-users"},{label:"Listar usuarios",value:"list-users"},{label:"Editar usuarios",value:"edit-users"},{label:"Eliminar usuarios",value:"delete-users"},{label:"Crear empresas",value:"create-business"},{label:"Listar empresas",value:"list-business"},{label:"Editar empresas",value:"edit-business"},{label:"Eliminar empresas",value:"delete-business"},{label:"Listar metricas",value:"list-meta-metric"},{label:"Listar ordenes",value:"list-orders"},{label:"Importar ordenes",value:"import-orders"}],$=async()=>{if(n.value=!0,s.value.username=s.value.email.split("@")[0],s.value._id)return await h(),!0;try{const d=await m.doSaveUser(s.value);d.success&&(V("positive",d.message,"primary"),o("close-modal"),b())}catch{}finally{n.value=!1}},h=async()=>{try{const d=await m.doUpdateUser(s.value);d.success&&(V("positive",d.message,"primary"),o("close-modal"),b())}catch{}finally{n.value=!1}},b=()=>{s.value={username:"",password:"",email:"",role:f.CEO,scopes:[],is_active:!0,name:"",last_name:"",confirmation_password:"",phone:""}};return F(()=>{e.userData._id&&(s.value=e.userData)}),{user:s,scopes:w,loading:n,typeUsers:t,doSaveUser:$,showPassword:i}}}),G=a("label",{for:"",class:"text-weight-semi-bold"},"Nombres",-1),Y=a("label",{for:"",class:"text-weight-semi-bold"},"Apellidos",-1),J=a("label",{for:"",class:"text-weight-semi-bold"},"Tipo de usuario",-1),K=a("label",{for:"",class:"text-weight-semi-bold"},"Correo",-1),W={class:"col-12 col-md-12"},X=a("label",{for:"",class:"text-weight-semi-bold"},"Tel\xE9fono",-1),x=a("label",{for:"",class:"text-weight-semi-bold"},"Contrase\xF1a",-1),ee=a("label",{for:"",class:"text-weight-semi-bold"},"Repetir contrase\xF1a",-1),se=a("label",{for:"",class:"text-weight-semi-bold"},"Permisos",-1);function oe(e,o,t,m,n,i){return C(),I(z,{class:"row",onSubmit:e.doSaveUser},{default:g(()=>[a("div",{class:u(["col-12 col-md-6",{"q-pr-sm":e.$q.screen.gt.sm}])},[G,r(v,{dense:"",modelValue:e.user.name,"onUpdate:modelValue":o[0]||(o[0]=s=>e.user.name=s),placeholder:"Ingrese su nombre completo",outlined:"",rounded:"",rules:[s=>!!s||"Este campo es requerido",s=>s.length<60||"60 caracteres maximos",s=>/^[a-zA-Z\s]+$/.test(s)||"Ingresa un nombre valido"]},null,8,["modelValue","rules"])],2),a("div",{class:u(["col-12 col-md-6",{"q-pl-sm":e.$q.screen.gt.sm}])},[Y,r(v,{dense:"",modelValue:e.user.last_name,"onUpdate:modelValue":o[1]||(o[1]=s=>e.user.last_name=s),placeholder:"Ingrese su nombre completo",outlined:"",rounded:"",rules:[s=>!!s||"Este campo es requerido",s=>s.length<60||"60 caracteres maximos",s=>/^[a-zA-Z\s]+$/.test(s)||"Ingresa un nombre valido"]},null,8,["modelValue","rules"])],2),a("div",{class:u(["col-12 col-md-6",{"q-pr-sm":e.$q.screen.gt.sm}])},[J,r(B,{"emit-value":"","map-options":"",dense:"",modelValue:e.user.role,"onUpdate:modelValue":o[2]||(o[2]=s=>e.user.role=s),label:"Seleccione un tipo de usuario",options:e.typeUsers,outlined:"",rounded:"",rules:[s=>!!s||"Este campo es requerido"]},null,8,["modelValue","options","rules"])],2),a("div",{class:u(["col-12 col-md-6",{"q-pl-sm":e.$q.screen.gt.sm}])},[K,r(v,{dense:"",modelValue:e.user.email,"onUpdate:modelValue":o[3]||(o[3]=s=>e.user.email=s),placeholder:"Ingrese su correo electr\xF3nico",outlined:"",rounded:"",rules:[s=>!!s||"Este campo es requerido",s=>/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(s)||"Ingresa un correo electr\xF3nico valido"]},null,8,["modelValue","rules"])],2),a("div",W,[X,r(v,{dense:"",modelValue:e.user.phone,"onUpdate:modelValue":o[4]||(o[4]=s=>e.user.phone=s),placeholder:"Ingrese un numero telef\xF3nico",outlined:"",rounded:"",rules:[s=>/^\d{1,3}\d{1,14}$/.test(s)||"Ingresa un n\xFAmero valido",s=>!!s||"Este campo es requerido",s=>s.length<15||"15 caracteres maximos"]},null,8,["modelValue","rules"])]),a("div",{class:u(["col-12 col-md-6",{"q-pr-sm":e.$q.screen.gt.sm}])},[x,r(v,{dense:"",type:e.showPassword?"text":"password",modelValue:e.user.password,"onUpdate:modelValue":o[6]||(o[6]=s=>e.user.password=s),placeholder:"Ingrese una contrase\xF1a segura",outlined:"",rounded:"",rules:e.user.password&&e.user.password.length>0?[s=>!!s||"Este campo es requerido",s=>/^(?=.*[A-Z])(?=.*[a-z])(?=.*\d)(?=.*[$@#&!*-])[A-Za-z\d$@#&!*-]{8,}$/.test(s)||"Ingresa una contrase\xF1a valida"]:[]},{append:g(()=>[r(U,{onClick:o[5]||(o[5]=s=>e.showPassword=!e.showPassword),flat:"",dense:"",rounded:"",icon:"img:images/eyegreen.svg"})]),_:1},8,["type","modelValue","rules"])],2),a("div",{class:u(["col-12 col-md-6",{"q-pl-sm":e.$q.screen.gt.sm}])},[ee,r(v,{dense:"",type:e.showPassword?"text":"password",modelValue:e.user.confirmation_password,"onUpdate:modelValue":o[8]||(o[8]=s=>e.user.confirmation_password=s),placeholder:"Repita la contrase\xF1a previamente ingresada",outlined:"",rounded:"",rules:e.user.password&&e.user.password.length>0?[s=>s===e.user.password||"No coinciden las contrase\xF1as",s=>!!s||"Este campo es requerido",s=>/^(?=.*[A-Z])(?=.*[a-z])(?=.*\d)(?=.*[$@#&!*-])[A-Za-z\d$@#&!*-]{8,}$/.test(s)||"Ingresa una contrase\xF1a valida"]:[]},{append:g(()=>[r(U,{onClick:o[7]||(o[7]=s=>e.showPassword=!e.showPassword),flat:"",dense:"",rounded:"",icon:"img:images/eyegreen.svg"})]),_:1},8,["type","modelValue","rules"])],2),a("div",{class:u(["col-12",{"q-mt-md":!e.user.password}])},[se,r(S,{inline:"",modelValue:e.user.scopes,"onUpdate:modelValue":o[9]||(o[9]=s=>e.user.scopes=s),options:e.scopes,color:"primary",type:"checkbox"},null,8,["modelValue","options"])],2),a("div",{class:u(["col-12 col-md-6 q-mt-xl",{"q-pr-sm":e.$q.screen.gt.sm}])},[T(r(U,{label:"Cancelar",color:"info","no-caps":"",rounded:"",outline:"",class:"full-width"},null,512),[[L]])],2),a("div",{class:u(["col-12 col-md-6 q-mt-xl",{"q-pl-sm":e.$q.screen.gt.sm}])},[r(U,{loading:e.loading,type:"submit",unelevated:"",label:e.user._id?"Editar usuario":"Crear usuario",color:"primary","no-caps":"",rounded:"",class:"full-width"},null,8,["loading","label"])],2)]),_:1},8,["onSubmit"])}var ae=A(R,[["render",oe]]);const re=E({name:"UserMainComponent",components:{formUser:ae,modalCard:_,HeaderComponent:H,TableAsiati:j},setup(){const e=Z(),o=c(!0),t=c({name:"",last_name:"",email:"",phone:"",role:f.CEO,scopes:[],is_active:!0,username:"",password:""}),m=c([{name:"name",align:"left",sortable:!1,label:"Nombre",field:l=>`${l.name} ${l.last_name}`},{name:"userType",align:"left",sortable:!1,field:l=>`${l.role}`,label:"Tipo usuario"},{name:"email",align:"left",sortable:!1,field:l=>`${l.email||"-"}`,label:"Correo"},{name:"phone",align:"left",sortable:!1,label:"Tel\xE9fono",field:l=>`${l.phone||"-"}`},{name:"option",align:"center",sortable:!1,label:""}]),n=M(),i=c(!1),s=D(()=>n.users),w=D(()=>n.totalItems),$=()=>{i.value=!i.value,t.value={name:"",last_name:"",email:"",phone:"",role:f.CEO,scopes:[],is_active:!0,username:"",password:""}},h=async()=>{try{const l=e.query.page||1,p=e.query.search||"",q=e.query.perPage||12,P=`?page=${l}&search=${p}&perPage=${q}`;await n.doListUsers(P)}catch{}},b=async l=>{try{(await n.doDeleteUser(l)).success&&V("positive","Usuario eliminado","primary")}catch{}},d=l=>{const p=n.users.find(q=>q._id===l);p&&typeof p=="object"&&(t.value=p,t.value.password="",i.value=!0)};return F(async()=>{await h()}),{rows:m,user:t,users:s,doEdit:d,render:o,openModal:$,deleteUser:b,totalItems:w,openModalUser:i}}}),le={class:"full-width"};function ne(e,o,t,m,n,i){const s=y("HeaderComponent"),w=y("TableAsiati"),$=y("form-user"),h=y("modalCard");return C(),N("section",le,[r(s,{permission:"create-users",title:"Usuarios",btnLabel:"Agregar usuario",onOpenModal:e.openModal},null,8,["onOpenModal"]),e.render?(C(),I(w,{key:0,"permission-edit":"edit-users","permission-delete":"delete-users",rows:e.rows,columns:e.users,"total-items":e.totalItems,onDoDelete:e.deleteUser,onDoEdit:e.doEdit},null,8,["rows","columns","total-items","onDoDelete","onDoEdit"])):Q("",!0),r(k,{modelValue:e.openModalUser,"onUpdate:modelValue":o[0]||(o[0]=b=>e.openModalUser=b)},{default:g(()=>[r(h,{title:e.user._id?"Editar usuario":"Usuario nuevo"},{body:g(()=>[r($,{userData:e.user,onCloseModal:e.openModal},null,8,["userData","onCloseModal"])]),_:1},8,["title"])]),_:1},8,["modelValue"])])}var te=A(re,[["render",ne]]);const ie=E({name:"UsersPage",components:{UserMain:te}});function de(e,o,t,m,n,i){const s=y("user-main");return C(),I(O,{padding:""},{default:g(()=>[r(s)]),_:1})}var we=A(ie,[["render",de]]);export{we as default};
