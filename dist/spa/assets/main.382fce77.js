import{Q as B}from"./QPage.715d6872.js";import{d as O,r as $,Y as v,e as M,a7 as F,_ as g,$ as y,aC as W,a2 as n,a1 as h,a6 as t,aa as C,F as R,a9 as q,ar as _,a4 as D,ab as k,ac as b,ad as S,a0 as A}from"./index.2f0c4fae.js";import{U as I}from"./utils.528ba315.js";import{Q as U}from"./QFile.13f5ae2c.js";import{u as N,a as j,H}from"./headers.e2e63168.js";import{Q as L}from"./QForm.57d357f4.js";import{C as G,M as z}from"./modalCard.e7fdc3b5.js";import{R as Y}from"./auth.b49303b4.js";import{notification as J}from"./notification.c42bd851.js";import{T as K,W as X}from"./models.4fd8c3a1.js";import{Q as x}from"./QTable.93a07d92.js";import{T as Z}from"./tableAsiati.ccdc534d.js";import"./use-quasar.13bf5623.js";const V="wallets",T=new Y({Accept:"application/json"}),P=O("walletsStore",()=>{const e=$([]),s=$(0);return{wallets:e,totalItems:s,doListWallets:async r=>{try{const o=await T.doGetRequest(`${V}`,r,!0);if(o.success)return e.value=o.data.wallets,s.value=o.data.totalItems,o}catch{}},doImportWallets:async r=>{try{const o=await T.doPostRequest(`${V}/import`,r,!0,!0);if(o.success)return o}catch{}}}}),ee=v({name:"WalletFormImportComponent",setup(e,{emit:s}){const d=new I("wallet"),c=$({file:null,company:null,type:K.DROPI}),r=$(!1),o=P(),a=N(),u=M(()=>a.companies.length>0?a.companies.map(m=>({label:`${m.name}`,value:m._id})):[]),i=async()=>{try{r.value=!0;const m=d.transformObjectInFormData(c.value,!1,null),l=await o.doImportWallets(m);l&&l.success&&(J("positive",l.message,"primary"),s("close-modal"))}catch{}finally{r.value=!1}},w=async()=>{try{await a.listForSelect()}catch{}},f=()=>{window.open("/excel/wallet_template.xlsx","_blank")};return F(async()=>{u.value.length>0||await w()}),{wallet:c,loading:r,companies:u,downloadExcel:f,doImportWalletMovements:i}}}),te={class:"full-width"},le={class:"col-12"},ae=t("label",{for:"",class:"text-weight-semi-bold"},"Archivo excel",-1),oe={class:"col-12"},se=t("label",{for:"",class:"text-weight-semi-bold"},"Tienda",-1),ne={class:"col-12"},re=t("label",{for:"",class:"text-weight-semi-bold"},"Bajar plantilla excel",-1);function ie(e,s,d,c,r,o){return y(),W("div",te,[n(L,{class:"row full-width",onSubmit:e.doImportWalletMovements},{default:h(()=>[t("div",le,[ae,n(U,{dense:"",modelValue:e.wallet.file,"onUpdate:modelValue":s[0]||(s[0]=a=>e.wallet.file=a),label:"Selecciona un archivo",outlined:"",rounded:"",rules:[a=>!!a||"Este campo es requerido"]},null,8,["modelValue","rules"])]),t("div",oe,[se,n(j,{options:e.companies,"map-options":"","emit-value":"",dense:"",modelValue:e.wallet.company,"onUpdate:modelValue":s[1]||(s[1]=a=>e.wallet.company=a),label:"Selecciona la tienda",outlined:"",rounded:"",rules:[a=>!!a||"Este campo es requerido"]},null,8,["options","modelValue","rules"])]),t("div",ne,[re,n(C,{flat:"",dense:"",icon:"download",onClick:e.downloadExcel,round:"",class:"q-ml-sm",color:"primary"},null,8,["onClick"])]),t("div",{class:q(["col-12 col-md-6 q-mt-xl",{"q-pr-sm":e.$q.screen.gt.sm}])},[R(n(C,{label:"Cancelar",color:"info","no-caps":"",rounded:"",outline:"",class:"full-width"},null,512),[[G]])],2),t("div",{class:q(["col-12 col-md-6 q-mt-xl",{"q-pl-sm":e.$q.screen.gt.sm}])},[n(C,{loading:e.loading,type:"submit",unelevated:"",label:"Importar",color:"primary","no-caps":"",rounded:"",class:"full-width"},null,8,["loading"])],2)]),_:1},8,["onSubmit"])])}var de=g(ee,[["render",ie]]);const ce=v({name:"DetailWalletComponent",props:{wallet:{type:Object,default:()=>({})}},setup(){return{utils:new I("oders")}}}),me={class:"full-weidth row"},pe={class:"col-12"},ue=t("thead",null,[t("tr",null,[t("th",{class:"text-left"},"Fecha"),t("th",{class:"text-left"},"Tipo"),t("th",{class:"text-left"},"# Gu\xEDa")])],-1),fe={class:"text-left"},we={class:"text-left"},_e={class:"text-left"},he=t("thead",null,[t("tr",null,[t("th",{class:"text-left"},"Orden id"),t("th",{class:"text-center"},"Monto"),t("th",{class:"text-center"},"Monto previo")])],-1),be={class:"text-left"},$e={class:"text-center"},ve={class:"text-center"},ge={class:"col-12 q-mt-md"},ye=t("span",{class:"font-12 text-primary text-weight-bold text-primary"},"N\xFAmero de gu\xEDa:",-1),Ce={class:"col-12 q-mt-md"},Me=t("span",{class:"font-12 text-primary text-weight-bold text-primary"},"Descripci\xF3n:",-1);function We(e,s,d,c,r,o){var a,u;return y(),W("div",me,[t("div",pe,[n(x,{class:"q-pa-none shadow-0"},{default:h(()=>{var i,w,f;return[ue,t("tbody",null,[t("tr",null,[t("td",fe,_((i=e.wallet.date)==null?void 0:i.substring(0,10)),1),t("td",we,_((w=e.wallet.type)!=null?w:"-"),1),t("td",_e,_((f=e.wallet.guide_number)!=null?f:"Sin gu\xEDa"),1)])])]}),_:1}),n(x,{class:"q-pa-none shadow-0 q-mt-md"},{default:h(()=>{var i;return[he,t("tbody",null,[t("tr",null,[t("td",be,_((i=e.wallet.order_id)!=null?i:"-"),1),t("td",$e,_(e.utils.formatPrice(e.wallet.amount)),1),t("td",ve,_(e.utils.formatPrice(e.wallet.preview_amount)),1)])])]}),_:1})]),t("div",ge,[ye,D(" "+_((a=e.wallet)==null?void 0:a.guide_number),1)]),t("div",Ce,[Me,D(" "+_((u=e.wallet)==null?void 0:u.description),1)])])}var Ie=g(ce,[["render",We]]);const qe=v({name:"WalletMainComponent",components:{ModalCard:z,FormImport:de,TableAsiati:Z,HeaderComponent:H,DetailWallet:Ie},setup(){const e=[{name:"external_id",align:"left",sortable:!1,label:"Id externo",field:l=>`${l.external_id}`},{name:"company",align:"left",sortable:!1,label:"Tienda",field:l=>{var p;return`${(p=l.company)==null?void 0:p.name}`}},{name:"date",align:"left",sortable:!1,label:"Fecha",field:l=>`${l.date?l.date.substring(0,10):"-"}`},{name:"type",align:"left",sortable:!1,label:"Tipo",field:l=>`${l.type}`},{name:"amount",align:"center",sortable:!1,label:"Monto",field:l=>`${c.formatPrice(l.amount)}`},{name:"amount_preview",align:"center",sortable:!1,label:"Monto previo",field:l=>`${c.formatPrice(l.preview_amount)}`},{name:"order_id",align:"left",sortable:!1,label:"Orden id",field:l=>{var p;return`${(p=l.order_id)!=null?p:"-"}`}},{name:"guide_number",align:"left",sortable:!1,label:"N\xB0 Gu\xEDa",field:l=>{var p;return`${(p=l.guide_number)!=null?p:"-"}`}},{name:"option",align:"center",sortable:!1,label:""}],s=$({amount:0,date:"",preview_amount:0,type:X.CREDIT,order_id:"",guide_number:"",external_id:"",description:""}),d=k(),c=new I("orders"),r=P(),o=$(!1),a=$(!1),u=M(()=>r.wallets),i=M(()=>r.totalItems),w=async()=>{o.value=!o.value,o.value||await f()},f=async()=>{try{const l=d.query.page||1,p=d.query.search||"",Q=d.query.perPage||12,E=`?page=${l}&search=${p}&perPage=${Q}`;await r.doListWallets(E)}catch{}},m=l=>{s.value=l,a.value=!a.value};return F(async()=>{await f()}),{rows:e,wallet:s,doShow:m,wallets:u,openModal:w,totalItems:i,openModalImport:o,openWalletDetail:a}}}),De={class:"full-width"};function Se(e,s,d,c,r,o){const a=b("HeaderComponent"),u=b("TableAsiati"),i=b("FormImport"),w=b("ModalCard"),f=b("DetailWallet"),m=b("modalCard");return y(),W("section",De,[n(a,{permission:"create-wallet",title:"Cartera",btnLabel:"Importar",onOpenModal:e.openModal},null,8,["onOpenModal"]),n(u,{permissionShow:"list-orders",rows:e.rows,columns:e.wallets,"total-items":e.totalItems,onDoShow:e.doShow},null,8,["rows","columns","total-items","onDoShow"]),n(S,{modelValue:e.openModalImport,"onUpdate:modelValue":s[0]||(s[0]=l=>e.openModalImport=l)},{default:h(()=>[n(w,{title:"Importar cartera"},{body:h(()=>[n(i,{onCloseModal:e.openModal},null,8,["onCloseModal"])]),_:1})]),_:1},8,["modelValue"]),n(S,{modelValue:e.openWalletDetail,"onUpdate:modelValue":s[1]||(s[1]=l=>e.openWalletDetail=l)},{default:h(()=>[n(m,{title:`Detalles de la orden ${e.wallet._id?e.wallet.external_id:""}`},{body:h(()=>[n(f,{wallet:e.wallet},null,8,["wallet"])]),_:1},8,["title"])]),_:1},8,["modelValue"])])}var xe=g(qe,[["render",Se]]);const Ve=v({name:"WalletMainPage",components:{WalletMainComponent:xe}});function Te(e,s,d,c,r,o){const a=b("WalletMainComponent");return y(),A(B,{padding:""},{default:h(()=>[n(a)]),_:1})}var Le=g(Ve,[["render",Te]]);export{Le as default};
